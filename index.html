<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GI Interactive Case – DMSc</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
--bg:#f0f8ff;
--card:#dbeafe;
--text:#1a2e4a;
--heading:#1b4f72;
--link:#1565c0;
--success:#1a7431;
--warning:#92400e;
--error:#991b1b;
--border:#5b8fbe;
}

body{
margin:0;
font-family:Inter,sans-serif;
background:var(--bg);
color:var(--text);
}

main{
max-width:1200px;
margin:auto;
padding:2rem;
}

header{
display:flex;
align-items:center;
gap:1rem;
}

header img{height:50px}

.card{
background:var(--card);
border:1px solid var(--border);
border-radius:12px;
padding:1.5rem;
margin-top:1.5rem;
}

.flex{
display:flex;
gap:1.5rem;
flex-wrap:wrap;
}

.flex img{
max-width:320px;
border-radius:10px;
}

h1,h2,h3{color:var(--heading)}

button{
display:block;
margin:.5rem 0;
padding:.75rem 1rem;
background:var(--link);
color:white;
border:none;
border-radius:6px;
font-size:1rem;
cursor:pointer;
}

button:hover{background:#0d47a1}

.nav{
margin-top:1.5rem;
display:flex;
gap:.5rem;
flex-wrap:wrap;
}

.feedback{
margin-top:1rem;
padding:.75rem;
border-radius:6px;
}

.success{background:#e6f4ea;border-left:6px solid var(--success)}
.error{background:#fde8e8;border-left:6px solid var(--error)}

.hidden{display:none}
</style>
</head>

<body>
<main>

<header>
<img src="dmsc-logo.png" alt="DMSc Logo">
<h1>GI Interactive Clinical Case</h1>
</header>

<div id="content" class="card"></div>

<div id="certificate" class="card hidden">
<h2>Certificate of Completion</h2>
<p>Enter your name:</p>
<input id="learnerName" style="padding:.5rem;width:100%;max-width:400px">
<br><br>
<button onclick="downloadCertificate()">Download Certificate</button>
</div>

</main>

<script>
/* ---------------- GLOBAL STATE ---------------- */
const content = document.getElementById("content");
let historyStack = [];

/* ---------------- NAV ---------------- */
function go(fn){ historyStack.push(fn); fn(); }
function back(){ if(historyStack.length>1){ historyStack.pop(); historyStack.at(-1)(); } }
function home(){ historyStack=[]; objectives(); }
function nav(){
return `<div class="nav">
<button onclick="back()">Back</button>
<button onclick="home()">Home</button>
</div>`;
}

/* ---------------- FEEDBACK ---------------- */
function feedback(type,msg){
document.getElementById("feedback").innerHTML=
`<div class="feedback ${type}">${msg}</div>`;
}
function correct(next){
feedback("success","Correct. Proceeding to the next step in care.");
setTimeout(()=>go(next),700);
}
function wrong(msg){
feedback("error",msg+" Please try again.");
}

/* ---------------- OBJECTIVES ---------------- */
function objectives(){
content.innerHTML=`
<img src="dmsc-logo.png" style="height:80px">
<h2>Objectives</h2>
<ul>
<li><strong>Analyze</strong> presenting symptoms to identify biliary pathology</li>
<li><strong>Interpret</strong> laboratory and imaging data in GI emergencies</li>
<li><strong>Apply</strong> evidence-based diagnostic and management strategies</li>
<li><strong>Evaluate</strong> complications and escalate care appropriately</li>
</ul>
<button onclick="go(part1)">Start Case</button>
`;
}

/* ---------------- PART 1 ---------------- */
function part1(){
content.innerHTML=`
<h2>Part 1 – Initial Presentation</h2>

<div class="flex">
<img src="avatar-patient.png">

<div>
<p><strong>A 45-year-old female presents to the ED with 2 days of worsening abdominal pain, nausea, and vomiting.</strong></p>

<h3>History</h3>
<ul>
<li>Pain started in upper abdomen, now more diffuse</li>
<li>Intermittent chills, no documented fever</li>
<li>PSHx: Cesarean section 12 years ago</li>
<li>PMHx: obesity, hyperlipidemia</li>
<li>Meds: none</li>
<li>Denies tobacco, alcohol, drug use</li>
</ul>

<h3>Vitals</h3>
<ul>
<li>T 37.9°C</li><li>HR 104</li><li>BP 132/84</li><li>RR 18</li><li>SpO₂ 99% RA</li>
</ul>

<h3>Exam</h3>
<ul>
<li>Slight scleral icterus</li>
<li>Generalized abdominal pain, worst in RUQ/epigastrium</li>
</ul>
</div>
</div>

<p><strong>Question 1: Initial diagnostic approach?</strong></p>

<button onclick="wrong('CT without contrast is useful for nephrolithiasis but may miss biliary pathology.')">CT abdomen/pelvis without contrast</button>
<button onclick="correct(part2)">RUQ ultrasound and laboratory evaluation</button>
<button onclick="wrong('Treatment without diagnosis risks missing obstruction.')">Start antibiotics and admit</button>
<button onclick="wrong('MRCP is not first-line in suspected biliary disease.')">MRCP immediately</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 2 ---------------- */
function part2(){
content.innerHTML=`
<h2>Part 2 – Diagnostic Results</h2>

<div class="flex">
<img src="ultrasound.png">

<div>
<h3>Labs</h3>
<ul>
<li>AST 220</li><li>ALT 260</li><li>Alk Phos 380</li>
<li>Total bilirubin 4.1</li><li>Lipase 68</li><li>WBC 9.4</li>
</ul>

<h3>RUQ Ultrasound</h3>
<ul>
<li>Gallstones present</li>
<li>Dilated CBD (12 mm)</li>
<li>No gallbladder wall thickening</li>
<li>No pericholecystic fluid</li>
</ul>
</div>
</div>

<p><strong>Question 2: Most likely diagnosis?</strong></p>

<button onclick="wrong('No sonographic evidence of cholecystitis.')">Acute cholecystitis</button>
<button onclick="wrong('Lipase is normal.')">Acute pancreatitis</button>
<button onclick="correct(part3)">Choledocholithiasis</button>
<button onclick="wrong('She lacks Charcot triad.')">Cholangitis</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 3 ---------------- */
function part3(){
content.innerHTML=`
<h2>Part 3 – Confirmatory Testing</h2>

<p><strong>Question 3: Best test to confirm choledocholithiasis?</strong></p>

<button onclick="wrong('Limited sensitivity for CBD stones.')">Repeat RUQ ultrasound</button>
<button onclick="wrong('CT can miss biliary stones.')">CT abdomen with IV contrast</button>
<button onclick="correct(part4)">MRCP</button>
<button onclick="wrong('Not ideal for identifying CBD stones.')">HIDA scan</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 4 ---------------- */
function part4(){
content.innerHTML=`
<h2>Part 4 – MRCP Results</h2>

<ul>
<li>8 mm stone in distal CBD</li>
<li>Mild intrahepatic biliary dilation</li>
<li>No pancreatitis</li>
</ul>

<p><strong>Question 4: Best next management step?</strong></p>

<button onclick="wrong('ERCP is typically performed before cholecystectomy.')">Immediate cholecystectomy</button>
<button onclick="correct(part5)">GI consultation for ERCP</button>
<button onclick="wrong('Obstruction requires stone removal.')">IV antibiotics and observation</button>
<button onclick="wrong('Reserved for unstable patients or failed ERCP.')">Percutaneous biliary drainage</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 5 ---------------- */
function part5(){
content.innerHTML=`
<h2>Part 5 – Post-ERCP Deterioration</h2>

<p><strong>10 hours post-ERCP</strong></p>
<ul>
<li>Severe epigastric pain</li>
<li>Vomiting</li>
<li>Tachycardia</li>
</ul>

<h3>Vitals</h3>
<ul>
<li>T 37.4°C</li><li>HR 127</li><li>BP 143/84</li><li>RR 24</li><li>SpO₂ 97% RA</li>
</ul>

<h3>Labs</h3>
<ul>
<li>WBC 15.6</li><li>Lactate 2.4</li>
<li>AST 540</li><li>ALT 490</li><li>Alk Phos 380</li>
<li>Total bilirubin 2.7</li><li>Lipase 1240</li>
</ul>

<h3>Imaging</h3>
<ul>
<li>KUB: diffuse mildly dilated small bowel consistent with ileus</li>
</ul>

<img src="avatar-post-ecrp.png">

<p><strong>Question 5: Most likely diagnosis?</strong></p>

<button onclick="wrong('Free air would be expected on imaging.')">ERCP-related duodenal perforation</button>
<button onclick="correct(part6)">Post-ERCP acute pancreatitis</button>
<button onclick="wrong('Labs not consistent with recurrent obstruction.')">Recurrent choledocholithiasis</button>
<button onclick="wrong('Missing Charcot triad.')">Cholangitis</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 6 (MULTISELECT) ---------------- */
function part6(){
content.innerHTML=`
<h2>Part 6 – Initial Management (Select all that apply)</h2>

<label><input type="checkbox" id="a"> Aggressive IV fluids</label>
<label><input type="checkbox" id="b"> Pain control</label>
<label><input type="checkbox" id="c"> Early enteral nutrition</label>
<label><input type="checkbox" id="d"> Broaden current antibiotics</label>
<label><input type="checkbox" id="e"> Immediate surgery</label>

<button onclick="check6()">Submit</button>
<div id="feedback"></div>
${nav()}
`;
}

function check6(){
const a=document.getElementById("a").checked;
const b=document.getElementById("b").checked;
const c=document.getElementById("c").checked;
const d=document.getElementById("d").checked;
const e=document.getElementById("e").checked;

if(a&&b&&c&&!d&&!e){
correct(part7);
}else{
wrong("Early fluids, analgesia, and enteral nutrition improve outcomes. Antibiotics and surgery are not indicated without complications.");
}
}

/* ---------------- PART 7 ---------------- */
function part7(){
content.innerHTML=`
<h2>Part 7 – Preventing Recurrence</h2>

<p><strong>Question 7: Best strategy to prevent recurrence?</strong></p>

<button onclick="wrong('Ursodiol is not effective for preventing obstruction.')">Ursodiol</button>
<button onclick="wrong('Dietary changes do not eliminate gallstones.')">Chronic low-fat diet</button>
<button onclick="correct(part8)">Cholecystectomy during same admission</button>
<button onclick="wrong('ERCP treats stones but does not prevent recurrence.')">Repeat ERCP</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 8 ---------------- */
function part8(){
content.innerHTML=`
<h2>Part 8 – POD #3</h2>

<ul>
<li>Worsening abdominal pain and distension</li>
<li>No bowel movements</li>
<li>Cecal diameter 16 cm</li>
<li>No mechanical obstruction</li>
</ul>

<p><strong>Question 8: Most likely diagnosis?</strong></p>

<button onclick="wrong('Post-op ileus causes diffuse small and large bowel dilation.')">Post-operative ileus</button>
<button onclick="wrong('No transition point seen.')">Mechanical small bowel obstruction</button>
<button onclick="correct(part9)">Acute colonic pseudo-obstruction (Ogilvie syndrome)</button>
<button onclick="wrong('No systemic toxicity or colitis.')">Toxic megacolon</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 9 ---------------- */
function part9(){
content.innerHTML=`
<h2>Part 9 – Management of Ogilvie Syndrome</h2>

<p><strong>Question 9: First-line management?</strong></p>

<button onclick="wrong('Neostigmine is reserved for refractory cases.')">Immediate neostigmine</button>
<button onclick="correct(part10)">Bowel rest, NG tube, and rectal decompression</button>
<button onclick="wrong('Surgery reserved for complications.')">Emergent colectomy</button>
<button onclick="wrong('Laxatives worsen colonic distension.')">Aggressive oral laxatives</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 10 ---------------- */
function part10(){
content.innerHTML=`
<h2>Part 10 – Failure of Conservative Therapy</h2>

<p>
Despite NG and rectal decompression, abdominal distention persists.
Repeat KUB shows cecal diameter of 13.8 cm.
</p>

<p><strong>Question 10: Best next step?</strong></p>

<button onclick="wrong('These agents do not improve colonic motility.')">Promotility agents</button>
<button onclick="correct(part11)">IV neostigmine with monitoring</button>
<button onclick="wrong('Contraindicated in Ogilvie syndrome.')">PEG bowel prep</button>
<button onclick="wrong('No infection present.')">Antibiotics</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 11 ---------------- */
function part11(){
content.innerHTML=`
<h2>Part 11 – Acute Deterioration</h2>

<ul>
<li>Severe worsening abdominal pain</li>
<li>Peritonitis</li>
<li>Free air under diaphragm</li>
</ul>

<p><strong>Question 11: Most appropriate action?</strong></p>

<button onclick="wrong('Contraindicated once perforation occurs.')">Repeat neostigmine</button>
<button onclick="wrong('Insufflation worsens contamination.')">Colonoscopic decompression</button>
<button onclick="correct(part12a)">Emergent surgery</button>
<button onclick="wrong('Life-threatening emergency.')">Observation</button>

<div id="feedback"></div>
${nav()}
`;
}

/* ---------------- PART 12 PAGES ---------------- */
function part12a(){
content.innerHTML=`
<h2>Operative Course</h2>
<p>Emergent exploratory laparotomy with right hemicolectomy and end ileostomy.</p>
<button onclick="go(part12b)">Next</button>
${nav()}
`;
}
function part12b(){
content.innerHTML=`
<h2>Postoperative Hospital Recovery</h2>
<p>ICU stabilization, antibiotics, gradual return of bowel function.</p>
<button onclick="go(part12c)">Next</button>
${nav()}
`;
}
function part12c(){
content.innerHTML=`
<h2>Discharge & Follow-Up</h2>
<p>Discharged home, no recurrent biliary disease.</p>
<button onclick="go(part12d)">Next</button>
${nav()}
`;
}
function part12d(){
content.innerHTML=`
<h2>Long-Term Outcome</h2>
<p>Successful ileostomy reversal at 6 months.</p>
<button onclick="go(part12e)">Next</button>
${nav()}
`;
}
function part12e(){
content.innerHTML=`
<h2>Key Teaching Pearls</h2>
<ul>
<li>Choledocholithiasis → MRCP → ERCP</li>
<li>ERCP carries pancreatitis risk</li>
<li>Ogilvie syndrome is functional obstruction</li>
<li>Cecal diameter >12 cm increases perforation risk</li>
</ul>
<button onclick="showCertificate()">Complete Activity</button>
${nav()}
`;
}

/* ---------------- CERTIFICATE ---------------- */
function showCertificate(){
  document.getElementById("certificate").classList.remove("hidden");
}

function downloadCertificate(){
  const nameInput = document.getElementById("learnerName");
  if (!nameInput || !nameInput.value.trim()) {
    alert("Please enter your name before downloading the certificate.");
    return;
  }

  const name = nameInput.value.trim();
  const date = new Date().toLocaleDateString();

  // Create canvas
  const canvas = document.createElement("canvas");
  canvas.width = 1200;
  canvas.height = 850;
  const ctx = canvas.getContext("2d");

  // Background
  ctx.fillStyle = "#f0f8ff"; // Alice Blue
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Border
  ctx.strokeStyle = "#1b4f72";
  ctx.lineWidth = 8;
  ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);

  // Title
  ctx.fillStyle = "#1b4f72";
  ctx.font = "bold 56px Inter, Arial";
  ctx.textAlign = "center";
  ctx.fillText("Certificate of Completion", canvas.width / 2, 180);

  // Body text
  ctx.fillStyle = "#1a2e4a";
  ctx.font = "28px Inter, Arial";
  ctx.fillText("This certifies that", canvas.width / 2, 280);

  // Name
  ctx.font = "bold 42px Inter, Arial";
  ctx.fillText(name, canvas.width / 2, 360);

  // Course text
  ctx.font = "28px Inter, Arial";
  ctx.fillText(
    "has successfully completed the",
    canvas.width / 2,
    430
  );

  ctx.font = "bold 30px Inter, Arial";
  ctx.fillText(
    "GI Interactive Clinical Case",
    canvas.width / 2,
    480
  );

  // Date
  ctx.font = "24px Inter, Arial";
  ctx.fillText("Date: " + date, canvas.width / 2, 560);

  // Footer
  ctx.font = "22px Inter, Arial";
  ctx.fillText(
    "Doctor of Medical Science (DMSc) Program",
    canvas.width / 2,
    640
  );

  // Download JPG
  const link = document.createElement("a");
  link.download = "GI_Case_Certificate.jpg";
  link.href = canvas.toDataURL("image/jpeg", 0.95);
  link.click();
}

